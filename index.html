<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ê–Ω–æ–Ω—ñ–º–Ω—ñ –∑–Ω–∞–π–æ–º—Å—Ç–≤–∞</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      background: #f5f5f5;
      color: #333;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h2, h3 {
      color: #0088cc;
    }
    textarea, input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      margin: 10px 0;
    }
    textarea {
      height: 120px;
      resize: vertical;
    }
    button {
      padding: 12px 24px;
      background: #0088cc;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    button:disabled {
      background: #ccc;
    }
    #status, #replyStatus {
      margin-top: 10px;
      min-height: 24px;
      font-weight: bold;
    }
    .success { color: #2e8b57; }
    .error { color: #c0392b; }
    code {
      background: #f0f0f0;
      padding: 2px 6px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üì© –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∞–Ω–æ–Ω—ñ–º–Ω–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</h2>
    <p>–ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ –ø—Ä–æ —Å–µ–±–µ —Ç–∞ –∫–æ–≥–æ —à—É–∫–∞—î—à (–≤—ñ–¥ 10 –¥–æ 500 —Å–∏–º–≤–æ–ª—ñ–≤):</p>
    <textarea id="postText" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –•–ª–æ–ø–µ—Ü—å, 25 —Ä–æ–∫—ñ–≤, –ª—é–±–ª—é –∫—ñ–Ω–æ —Ç–∞ –ø—Ä–æ–≥—É–ª—è–Ω–∫–∏ —É –õ—å–≤–æ–≤—ñ..."></textarea>
    <br>
    <button onclick="submitPost()" id="submitBtn">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
    <div id="status"></div>

    <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤—ñ–¥–≥—É–∫—É -->
    <div style="margin-top: 30px; padding: 20px; background: #f9f9f9; border-radius: 12px;">
      <h3>üí¨ –í—ñ–¥–≥—É–∫–Ω—É—Ç–∏—Å—è –Ω–∞ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</h3>
      <p>–ó–Ω–∞–π–¥–∏ ID –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –≤ –∫–∞–Ω–∞–ª—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: <code>5NOD</code>) —ñ –Ω–∞–ø–∏—à–∏ –∞–≤—Ç–æ—Ä—É –∞–Ω–æ–Ω—ñ–º–Ω–æ:</p>
      <input type="text" id="postId" placeholder="ID –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: 5NOD)">
      <textarea id="replyText" placeholder="–¢–≤—ñ–π —Ç–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..."></textarea>
      <br>
      <button onclick="submitReply()" id="submitReplyBtn">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≤—ñ–¥–≥—É–∫</button>
      <div id="replyStatus"></div>
    </div>
  </div>

  <script>
    const WebApp = window.Telegram.WebApp;
    WebApp.ready();
    WebApp.expand();

    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzme9bv5wLH9fPp091ou9JSs81ybQbfcMV4psC0nod4HngiMN4LXIotTbokJqIF97hw/exec';

    async function submitPost() {
      const text = document.getElementById('postText').value.trim();
      const statusEl = document.getElementById('status');
      const btn = document.getElementById('submitBtn');

      if (text.length < 10) {
        statusEl.className = 'error';
        statusEl.innerText = '–¢–µ–∫—Å—Ç –º–∞—î –±—É—Ç–∏ –Ω–µ –º–µ–Ω—à–µ 10 —Å–∏–º–≤–æ–ª—ñ–≤.';
        return;
      }
      if (text.length > 500) {
        statusEl.className = 'error';
        statusEl.innerText = '–¢–µ–∫—Å—Ç –∑–∞–Ω–∞–¥—Ç–æ –¥–æ–≤–≥–∏–π (–º–∞–∫—Å. 500 —Å–∏–º–≤–æ–ª—ñ–≤).';
        return;
      }

      const userId = WebApp.initDataUnsafe?.user?.id;
      if (!userId) {
        statusEl.className = 'error';
        statusEl.innerText = '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∞—à ID.';
        return;
      }

      btn.disabled = true;
      statusEl.innerText = '–ù–∞–¥—Å–∏–ª–∞—î–º–æ...';

      const url = `${SCRIPT_URL}?action=post&user_id=${encodeURIComponent(userId)}&text=${encodeURIComponent(text)}`;

      try {
        await fetch(url);
        statusEl.className = 'success';
        statusEl.innerText = '‚úÖ –û–≥–æ–ª–æ—à–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ!';
        document.getElementById('postText').value = '';
      } catch (e) {
        statusEl.className = 'error';
        statusEl.innerText = '–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è.';
      } finally {
        btn.disabled = false;
      }
    }

    async function submitReply() {
      const postId = document.getElementById('postId').value.trim();
      const text = document.getElementById('replyText').value.trim();
      const statusEl = document.getElementById('replyStatus');
      const btn = document.getElementById('submitReplyBtn');

      if (!postId || !text) {
        statusEl.className = 'error';
        statusEl.innerText = '–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–∏–¥–≤–∞ –ø–æ–ª—è.';
        return;
      }
      if (text.length > 500) {
        statusEl.className = 'error';
        statusEl.innerText = '–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–∞–Ω–∞–¥—Ç–æ –¥–æ–≤–≥–µ.';
        return;
      }

      const userId = WebApp.initDataUnsafe?.user?.id;
      if (!userId) {
        statusEl.className = 'error';
        statusEl.innerText = '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∞—à ID.';
        return;
      }

      btn.disabled = true;
      statusEl.innerText = '–ù–∞–¥—Å–∏–ª–∞—î–º–æ...';

      const url = `${SCRIPT_URL}?action=reply&user_id=${encodeURIComponent(userId)}&post_id=${encodeURIComponent(postId)}&reply_text=${encodeURIComponent(text)}`;

      try {
        await fetch(url);
        statusEl.className = 'success';
        statusEl.innerText = '‚úÖ –í—ñ–¥–≥—É–∫ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ!';
        document.getElementById('postId').value = '';
        document.getElementById('replyText').value = '';
      } catch (e) {
        statusEl.className = 'error';
        statusEl.innerText = '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—ñ.';
      } finally {
        btn.disabled = false;
      }
    }
  </script>
</body>
</html>
