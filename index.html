<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Знайомства у місті</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    textarea { width: 100%; height: 100px; margin: 10px 0; }
    button { padding: 10px 20px; background: #0088cc; color: white; border: none; border-radius: 5px; }
  </style>
</head>
<body>
  <h2>Анонімне оголошення</h2>
  <p>Напиши коротко про себе та кого шукаєш (макс. 500 символів):</p>
  <textarea id="postText" placeholder="Наприклад: Дівчина, 24 роки, люблю каву та прогулянки у парку..."></textarea>
  <br>
  <button onclick="submitPost()">Надіслати</button>
  <p id="status"></p>

  <script>
    const WebApp = window.Telegram.WebApp;
    WebApp.ready();

    async function submitPost() {
      const text = document.getElementById('postText').value.trim();
      const statusEl = document.getElementById('status');

      if (!text || text.length < 10) {
        statusEl.innerText = 'Текст занадто короткий!';
        return;
      }
      if (text.length > 500) {
        statusEl.innerText = 'Максимум 500 символів!';
        return;
      }

      statusEl.innerText = 'Надсилаємо...';

      // Отримуємо user ID з Telegram WebApp
      const userId = WebApp.initDataUnsafe?.user?.id;
      if (!userId) {
        statusEl.innerText = 'Помилка: не вдалося отримати ваш ID';
        return;
      }

      // Надсилаємо в Google Apps Script
      const response = await fetch('https://script.google.com/macros/s/ВАШ_ГОТОВИЙ_URL/exec', {
        method: 'POST',
        mode: 'no-cors', // важливо для Google Apps Script
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `user_id=${userId}&text=${encodeURIComponent(text)}`
      });

      // Через no-cors ми не бачимо відповідь, тому вважаємо успіх
      statusEl.innerText = '✅ Надіслано! Оголошення з’явиться в каналі найближчим часом.';
      document.getElementById('postText').value = '';
    }
  </script>
</body>
</html>
