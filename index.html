<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ê–Ω–æ–Ω—ñ–º–Ω—ñ –∑–Ω–∞–π–æ–º—Å—Ç–≤–∞</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      background: #f5f5f5;
      color: #333;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
      color: #0088cc;
    }
    textarea {
      width: 100%;
      height: 120px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      margin: 10px 0;
      resize: vertical;
    }
    button {
      padding: 12px 24px;
      background: #0088cc;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    button:disabled {
      background: #ccc;
    }
    #status {
      margin-top: 10px;
      min-height: 24px;
      font-weight: bold;
    }
    .success { color: #2e8b57; }
    .error { color: #c0392b; }
  </style>
</head>
<body>
  <div class="container">
    <h2>üì© –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∞–Ω–æ–Ω—ñ–º–Ω–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</h2>
    <p>–ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ –ø—Ä–æ —Å–µ–±–µ —Ç–∞ –∫–æ–≥–æ —à—É–∫–∞—î—à (–≤—ñ–¥ 10 –¥–æ 500 —Å–∏–º–≤–æ–ª—ñ–≤):</p>
    <textarea id="postText" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –•–ª–æ–ø–µ—Ü—å, 25 —Ä–æ–∫—ñ–≤, –ª—é–±–ª—é –∫—ñ–Ω–æ —Ç–∞ –ø—Ä–æ–≥—É–ª—è–Ω–∫–∏ —É –õ—å–≤–æ–≤—ñ..."></textarea>
    <br>
    <button onclick="submitPost()" id="submitBtn">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
    <div id="status"></div>
  </div>

  <script>
    const WebApp = window.Telegram.WebApp;
    WebApp.ready();
    WebApp.expand();

    async function submitPost() {
      const text = document.getElementById('postText').value.trim();
      const statusEl = document.getElementById('status');
      const btn = document.getElementById('submitBtn');

      if (text.length < 10) {
        statusEl.className = 'error';
        statusEl.innerText = '–¢–µ–∫—Å—Ç –º–∞—î –±—É—Ç–∏ –Ω–µ –º–µ–Ω—à–µ 10 —Å–∏–º–≤–æ–ª—ñ–≤.';
        return;
      }
      if (text.length > 500) {
        statusEl.className = 'error';
        statusEl.innerText = '–¢–µ–∫—Å—Ç –∑–∞–Ω–∞–¥—Ç–æ –¥–æ–≤–≥–∏–π (–º–∞–∫—Å. 500 —Å–∏–º–≤–æ–ª—ñ–≤).';
        return;
      }

      const userId = WebApp.initDataUnsafe?.user?.id;
      if (!userId) {
        statusEl.className = 'error';
        statusEl.innerText = '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∞—à ID. –°–ø—Ä–æ–±—É–π—Ç–µ –æ–Ω–æ–≤–∏—Ç–∏ Telegram.';
        return;
      }

      btn.disabled = true;
      statusEl.className = '';
      statusEl.innerText = '–ù–∞–¥—Å–∏–ª–∞—î–º–æ...';

      // üîÅ –ù–∞–¥—Å–∏–ª–∞—î–º–æ –≤ Google Apps Script
      const scriptUrl = 'https://script.google.com/macros/s/AKfycbySRpXl7LWrsyeJEQEQ4P0UQ4vLlR4_o-i4atm-xYA7mbAaJCOprOzigeDTAWfiUFAP/exec';

      try {
        // –ß–µ—Ä–µ–∑ –æ–±–º–µ–∂–µ–Ω–Ω—è CORS –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ no-cors (–¥–∞–Ω—ñ –π–¥—É—Ç—å, –∞–ª–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–µ —á–∏—Ç–∞—î—Ç—å—Å—è)
        await fetch(scriptUrl, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: `user_id=${encodeURIComponent(userId)}&text=${encodeURIComponent(text)}`
        });

        // –í–≤–∞–∂–∞—î–º–æ —É—Å–ø—ñ—Ö (–±–æ –Ω—ñ—è–∫–æ—ó –ø–æ–º–∏–ª–∫–∏ –Ω–µ –±—É–ª–æ)
        statusEl.className = 'success';
        statusEl.innerText = '‚úÖ –û–≥–æ–ª–æ—à–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ! –í–æ–Ω–æ –∑‚Äô—è–≤–∏—Ç—å—Å—è –≤ –∫–∞–Ω–∞–ª—ñ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º.';
        document.getElementById('postText').value = '';
      } catch (e) {
        statusEl.className = 'error';
        statusEl.innerText = '–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.';
      } finally {
        btn.disabled = false;
      }
    }
  </script>
</body>
</html>
